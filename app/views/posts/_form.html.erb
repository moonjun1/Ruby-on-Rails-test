<%= form_with(model: post, local: true, class: "needs-validation", novalidate: true) do |form| %>
  <% if post.errors.any? %>
    <div class="alert alert-danger">
      <h4>âš ï¸ <%= pluralize(post.errors.count, "ê°œì˜ ì˜¤ë¥˜") %>ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:</h4>
      <ul class="mb-0">
        <% post.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= form.label :title, "ğŸ“ ì œëª©", class: "form-label" %>
    <%= form.text_field :title, 
        class: "form-control #{'is-invalid' if post.errors[:title].any?}", 
        placeholder: "í¬ìŠ¤íŠ¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”...",
        required: true %>
    <% if post.errors[:title].any? %>
      <div class="invalid-feedback">
        <%= post.errors[:title].first %>
      </div>
    <% end %>
  </div>

  <div class="mb-3">
    <%= form.label :content, "ğŸ“„ ë‚´ìš© (ë§ˆí¬ë‹¤ìš´)", class: "form-label" %>
    <%= form.text_area :content, 
        class: "form-control #{'is-invalid' if post.errors[:content].any?}", 
        rows: 20, 
        placeholder: "ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì„ ì‚¬ìš©í•´ì„œ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”...\n\nì˜ˆì‹œ:\n# ì œëª©\n## ì†Œì œëª©\n\n**êµµì€ ê¸€ì”¨**ì™€ *ê¸°ìš¸ì„* ê¸€ì”¨\n\n- ë¦¬ìŠ¤íŠ¸ í•­ëª© 1\n- ë¦¬ìŠ¤íŠ¸ í•­ëª© 2\n\n```ruby\ndef hello\n  puts 'Hello, World!'\nend\n```\n\n> ì¸ìš©êµ¬ì…ë‹ˆë‹¤.\n\n[ë§í¬](https://example.com)",
        required: true %>
    <% if post.errors[:content].any? %>
      <div class="invalid-feedback">
        <%= post.errors[:content].first %>
      </div>
    <% end %>
    <div class="form-text">
      ğŸ’¡ <strong>ë§ˆí¬ë‹¤ìš´ ë¬¸ë²• ê°€ì´ë“œ:</strong>
      <code>#</code> ì œëª©, <code>**êµµê²Œ**</code> êµµì€ê¸€ì”¨, <code>*ê¸°ìš¸ì„*</code> ê¸°ìš¸ì„ê¸€ì”¨, 
      <code>```ì–¸ì–´</code> ì½”ë“œë¸”ë¡, <code>&gt;</code> ì¸ìš©êµ¬, <code>- </code> ë¦¬ìŠ¤íŠ¸
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-6">
      <div class="form-check">
        <%= form.check_box :published, class: "form-check-input" %>
        <%= form.label :published, "ğŸš€ ë°”ë¡œ ë°œí–‰í•˜ê¸°", class: "form-check-label" %>
        <div class="form-text">
          ì²´í¬í•˜ì§€ ì•Šìœ¼ë©´ ì´ˆì•ˆìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="card bg-light">
        <div class="card-body py-2">
          <small class="text-muted">
            <strong>ğŸ’¡ íŒ:</strong> ì´ˆì•ˆìœ¼ë¡œ ì €ì¥í•œ í›„ ë¯¸ë¦¬ë³´ê¸°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!
          </small>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex gap-2">
    <%= form.submit post.persisted? ? "ğŸ’¾ ì—…ë°ì´íŠ¸" : "ğŸ’¾ ì €ì¥í•˜ê¸°", 
        class: "btn btn-primary btn-lg" %>
    
    <% if post.persisted? && !post.published? %>
      <%= link_to "ğŸ‘€ ë¯¸ë¦¬ë³´ê¸°", post_path(post, preview: true), 
          class: "btn btn-outline-info", target: "_blank" %>
    <% end %>
    
    <%= link_to "âŒ ì·¨ì†Œ", post.persisted? ? post : posts_path, 
        class: "btn btn-outline-secondary" %>
  </div>
<% end %>

<script>
// ìë™ ì €ì¥ ê¸°ëŠ¥ (ì„ íƒì‚¬í•­)
let autoSaveTimer;
const titleField = document.querySelector('#post_title');
const contentField = document.querySelector('#post_content');

function showAutoSaveStatus(message) {
  // ê°„ë‹¨í•œ ì•Œë¦¼ í‘œì‹œ
  const existingAlert = document.querySelector('.auto-save-alert');
  if (existingAlert) existingAlert.remove();
  
  const alert = document.createElement('div');
  alert.className = 'alert alert-info alert-dismissible fade show auto-save-alert position-fixed';
  alert.style = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
  alert.innerHTML = message + '<button type="button" class="btn-close" data-bs-dismiss="alert"></button>';
  document.body.appendChild(alert);
  
  setTimeout(() => {
    if (alert.parentNode) alert.parentNode.removeChild(alert);
  }, 3000);
}

// í¼ ìœ íš¨ì„± ê²€ì‚¬
(function() {
  'use strict';
  const forms = document.querySelectorAll('.needs-validation');
  Array.prototype.slice.call(forms).forEach(function(form) {
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
        showAutoSaveStatus('âš ï¸ í•„ìˆ˜ í•­ëª©ì„ í™•ì¸í•´ì£¼ì„¸ìš”!');
      }
      form.classList.add('was-validated');
    }, false);
  });
})();
</script>